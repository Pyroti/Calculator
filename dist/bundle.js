(()=>{"use strict";const e=function(e,n,t){this.execute=e,this.undo=n,this.value=t},n=(e,n)=>e+n,t=(e,n)=>e-n,u=(e,n)=>e*n,o=(e,n)=>e/n,r=e=>e/100,l=e=>100*e,a=e=>e**2,c=e=>e**.5,i=e=>e**3,s=e=>e**(1/3),d=(e,n)=>e**n,f=(e,n)=>e**(1/n),v=e=>Math.E**e,w=e=>Math.log(e)/Math.log(Math.E),m=e=>Math.log10(e),x=e=>10**e,h=e=>1/e,g=e=>Math.log(e),p=function(u){return new e(n,t,u)},N=function(u){return new e(t,n,u)},E=function(n){return new e(u,o,n)},y=function(n){return new e(o,u,n)},q=function(n){return new e(r,l,n)},b=function(n){return new e(a,c,n)},S=function(n){return new e(c,a,n)},L=function(n){return new e(i,s,n)},M=function(n){return new e(s,i,n)},$=function(n){return new e(d,f,n)},A=function(n){return new e(f,d,n)},C=function(n){return new e(v,w,n)},V=function(n){return new e(m,x,n)},_=function(n){return new e(x,m,n)},O=function(n){return new e(h,h,n)},F=function(n){return new e(g,v,n)},I=[],j=[],k=function(){let e=0;return{execute(n){e=n.execute(e,n.value),Number.isNaN(e)||e===1/0||(I.push(n),j.push(e))},undo(){if(I.length>0){const n=I.pop(),t=j.pop();e=n.undo(t,n.value)}},setValue(n,t){e=n,"AC"===t&&(I.length=0,j.length=0)},getCurrentValue:()=>e}},z=document.querySelector(".calc__result");let B=0;const D=document.querySelectorAll(".operation"),G=document.querySelectorAll(".num"),H=document.querySelector(".calc__result"),J=document.querySelector(".equels"),K=document.querySelector(".clear"),P=document.querySelector(".undo"),Q=document.querySelectorAll(".memory-operation"),R=document.querySelector(".negative-operation"),T=["%","2x","x2","3x","x3","exp","log","10x","1/x","ln"];let U="",W="",X="",Y=!1;function Z(){W=function(e,n,t){const u=new Map([["+",new p(+n)],["-",new N(+n)],["*",new E(+n)],["/",new y(+n)],["%",new q(+n)],["x2",new b(+n)],["2x",new S(+n)],["x3",new L(+n)],["3x",new M(+n)],["^",new $(+n)],["^(1/",new A(+n)],["exp",new C(+n)],["log",new V(+n)],["10x",new _(+n)],["1/x",new O(+n)],["ln",new F(+n)]]),o=new k;"undo"!==t&&o.setValue(+e,t),u.has(t)?o.execute(u.get(t)):"AC"===t?o.setValue(0,t):"undo"===t&&o.undo();const r=Number(o.getCurrentValue().toFixed(10));return Number.isNaN(r)||r===1/0?(z.value="неправильная операция","0"):(z.value=r,`${r}`)}(W,X,U),X=""}function ee(e){if("неправильная операция"===H.value)return void(H.value=W);Y&&(H.value="",Y=!1);const n=e.target.dataset.value,t="number"==typeof Number(n),u=Number.isNaN(parseInt(n,10));!function(e){const n="."===e,t=""===U,u=-1===W.indexOf("."),o=-1===X.indexOf(".");if(n&&t&&u)W+=".",H.value+=".";else if(n&&!t&&o){const e=""===X?"0.":".";X+=e,H.value+=e}}(n),t&&!u&&""===U?("0"===H.value&&(H.value=""),W+=n,H.value+=n):t&&!u&&""!==U&&(X+=n,H.value+=n)}function ne(e){if("неправильная операция"===H.value)return void(H.value=W);const n=e.target.dataset.value;""!==U&&""!==X&&Z(),""!==U&&""===X&&(H.value=H.value.replace(U,"")),U=n,H.value+=n,T.includes(U)&&Z()}function te(e){if("неправильная операция"===H.value)return void(H.value=W);""!==X&&Z();const[n,t]=function(e,n){const t=e.target.dataset.value;if("m+"===t)B+=+n;else if("m-"===t)B-=+n;else{if("mc"!==t)return[B,!0];B=0}return[B,!1]}(e,W);!0===t&&(H.value=n,W="0",Y=!0)}D.forEach((e=>{e.addEventListener("mousedown",ne)})),G.forEach((e=>{e.addEventListener("mousedown",ee)})),Q.forEach((e=>{e.addEventListener("mousedown",te)})),R.addEventListener("mousedown",(function(){if("неправильная операция"===H.value)return void(H.value=W);const e=""===U,n=T.includes(U),t=""===X;e||n?(W=""+-1*Number(W),H.value=W):e||n||t||(X=""+-1*Number(X),Number(X)<=0?H.value=`${W}${U}(${X})`:H.value=`${W}${U}${X}`)})),J.addEventListener("mousedown",(function(){"неправильная операция"!==H.value?""!==X&&(Z(),U=""):H.value=W})),K.addEventListener("mousedown",(function(){U="AC",Z(),U=""})),P.addEventListener("mousedown",(function(){U="undo",Z(),U=""}))})();